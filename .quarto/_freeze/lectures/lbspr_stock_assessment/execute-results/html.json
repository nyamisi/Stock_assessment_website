{
  "hash": "e9d673e15ac53461d40dd81a7de3ea6d",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"AQ 232: Fish Population Dynamics and Stock Assessment\"\nsubtitle: \"Stock Assessment using LBSPR Model in R\"\ndate: \"today\"\nauthor: \"Nyamisi Peter\"\nformat: html\n    # revealjs:\n    #   standalone: true\n    #   embed-resources: true\n    #   reference-location: document\n    #   theme: serif\n    #   highlight-style: ayu-mirage\nexecute: \n  echo: false\n  warning: false\n  message: false\n  comment: \"\"\n\nslide-number: true\ntheme: \"journal\"\ncode-fold: false\nscrollable: true\ncode-line-numbers: true\ncss: ../style.css\n---\n\n# Introduction to LBSPR Model\n\n- Length-based spawning potential ratio (LBSPR) model is a stock assessment tool that uses length frequency data to estimate fishing mortality and spawning potential ratio (SPR) of fish populations.\n- It is particularly useful for data-limited fisheries where traditional stock assessment methods may not be feasible.\n- The model relies on biological parameters such as growth, maturity, and natural mortality to estimate the impact of fishing on the spawning stock.\n\n# LBSPR Model Implementation in R\n\n## Package used\n\nDifferent R packages are used to implement the LBSPR model. These include:\n\n    + `LBSPR`: This package provides functions to fit the LBSPR model to length frequency data and estimate fishing mortality and SPR.\n    + `TropFishR`: This package offers tools for analyzing tropical fishery data, including length frequency analysis and growth modeling.\n    + `sizeMat`: This package is used to model size-based maturity ogives, which are essential for estimating spawning potential.\n\n## Load packages\n\n\n\n::: {.cell}\n\n:::\n\n\n## Load data\n\n\n::: {.cell}\n\n:::\n\n\n## Identify Species with Sufficient Data\n\nWhat we’re doing: Filter for fish species with at least 200 recorded individuals to ensure statistical reliability.\n\nWhy it matters: Species with few observations may have unreliable estimates. Focus on well-sampled species improves analysis quality.\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"YFT\" \"SKJ\" \"KAW\" \"JAC\" \"LOT\" \"MAH\" \"SCH\"\n```\n\n\n:::\n:::\n\n\n\n## Create Species Reference Table\n\nWhat we’re doing: Build a lookup table mapping FAO species codes to common and scientific names.\n\nWhy it matters: Clear species identification is essential for communicating results to stakeholders and ensuring accurate interpretation.\n\n\n::: {.cell}\n\n:::\n\n\n## Inspect Dataset Structure\nWhat we’re doing: Display the column names and data types in the dataset.\n\nWhat to look for: Ensure date, length, weight, and species columns are present and correctly formatted.\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 3,571\nColumns: 19\n$ boat_id              <dbl> 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3…\n$ catch_id             <dbl> 1, 1, 1, 1, 1, 3, 7, 7, 7, 4, 4, 5, 5, 5, 9, 9, 9…\n$ fish_id              <dbl> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15…\n$ date_dd_mm_yy        <dttm> 2018-11-02, 2018-11-02, 2018-11-02, 2018-11-02, …\n$ year                 <dbl> 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2…\n$ month                <chr> \"Nov\", \"Nov\", \"Nov\", \"Nov\", \"Nov\", \"Nov\", \"Nov\", …\n$ day                  <dbl> 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2…\n$ region               <chr> \"Mogadishu\", \"Mogadishu\", \"Mogadishu\", \"Mogadishu…\n$ landing_site         <chr> \"Lido Beach\", \"Lido Beach\", \"Lido Beach\", \"Lido B…\n$ vessel_id            <dbl> 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3…\n$ fish_type_code       <chr> \"YFT\", \"YFT\", \"YFT\", \"YFT\", \"YFT\", \"MAH\", \"OTH1\",…\n$ fish_index           <dbl> 1, 2, 3, 4, 5, 1, 1, 2, 3, 1, 2, 1, 2, 3, 1, 2, 3…\n$ weight_kg            <dbl> 7.7, 3.6, 4.5, 4.5, 3.2, 9.5, 2.3, 3.2, 2.3, 11.0…\n$ length_cm            <dbl> 76, 59, 65, 67, 61, 124, 55, 64, 55, 84, 85, 62, …\n$ fish_group           <chr> \"Tuna\", \"Tuna\", \"Tuna\", \"Tuna\", \"Tuna\", \"Other\", …\n$ notes                <chr> NA, NA, NA, NA, NA, NA, \"Aarjoog\", \"Aarjoog\", \"Aa…\n$ kobo_section_1_index <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…\n$ kobo_section_2_index <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…\n$ kobo_section_3_index <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…\n```\n\n\n:::\n:::\n\n\n## Fish Groups Analysis\n\nIn the following sections, we will perform length-frequency analysis for several key tuna and mackerel species. For each species, we filter the data and convert it into a structured length-frequency format suitable for growth and mortality analyses.\n\n### Skipjack tuna Example\n\nWhat we’re doing: Filter the main dataset to create a subset containing only Skipjack tuna (SKJ) observations.\n\nWhy start here: Skipjack tuna is a well-studied species with good sample sizes, making it ideal for demonstrating the analysis workflow.\n\n\n::: {.cell}\n\n:::\n\n\n## LFQ Creation\n\nWhat we’re doing: Convert raw individual fish length measurements into a length-frequency object using the `lfqCreate()` function.\n\nThe process: 1. Standardize dates to a proper date format 2. Aggregate measurements into 2 cm length bins 3. Group by sampling date to create a time series 4. Create an lfq object ready for further analysis\n\nWhy it matters: LFQ objects organize data into the standardized format required by growth and mortality estimation methods.\n\n\n::: {.cell}\n\n:::\n\n\n## LFQ Modification and Restructuring\n\nWhat we’re doing: Process the LFQ object to improve visualization of cohort progression: 1. Aggregate samples into monthly groups (rather than daily) 2. Increase length bin size to 5 cm for clearer visualization 3. Apply moving average smoothing (11-month window) to reduce noise 4. Apply square-root transformation to stabilize variance\n\nWhy each step matters: - Monthly aggregation: Reduces noise from daily variation - 5 cm bins: Easier to visualize growth patterns - Moving average: Highlights cohort trajectories by smoothing random fluctuations - Square-root transformation: Large catches don’t visually dominate small catches\n\n\n::: {.cell}\n\n:::\n\n\n## Plot Restructured Length-Frequency Data\n\nWhat we’re doing: Visualize the processed length-frequency data as a contour or heatmap showing how fish sizes change over time.\n\nWhat to look for: - Diagonal bands: Show cohorts (same-aged groups) growing through size classes - Modal length: The most common size in each time period - Recruitment pulses: New fish entering the fishery (smallest sizes) - Gaps: May indicate periods of low recruitment or high fishing on young fish\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](lbspr_stock_assessment_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n## Summary for All Species\n\nWhat we’re doing: Automate the entire LFQ workflow for all selected species using a loop.\n\nWorkflow for each species: 1. Filter data for that species 2. Standardize dates to 2024 (keep original month) 3. Create LFQ object with 2 cm bins 4. Modify to monthly bins with 5 cm length classes 5. Restructure with 9-month moving average and square-root transformation 6. Plot the results\n\nWhy standardize to one year: Allows easy visual comparison of seasonal patterns across species by plotting the annual cycle.\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\nPress ENTER to see next species\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](lbspr_stock_assessment_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\nPress ENTER to see next species\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](lbspr_stock_assessment_files/figure-html/unnamed-chunk-10-2.png){width=672}\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\nPress ENTER to see next species\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](lbspr_stock_assessment_files/figure-html/unnamed-chunk-10-3.png){width=672}\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\nPress ENTER to see next species\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](lbspr_stock_assessment_files/figure-html/unnamed-chunk-10-4.png){width=672}\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\nPress ENTER to see next species\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](lbspr_stock_assessment_files/figure-html/unnamed-chunk-10-5.png){width=672}\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\nPress ENTER to see next species\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](lbspr_stock_assessment_files/figure-html/unnamed-chunk-10-6.png){width=672}\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\nPress ENTER to see next species\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](lbspr_stock_assessment_files/figure-html/unnamed-chunk-10-7.png){width=672}\n:::\n:::\n\n\n\n\n\n\n\n\n",
    "supporting": [
      "lbspr_stock_assessment_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}